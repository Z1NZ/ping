language: c
sudo: false
dist: trusty
script:
  - scan-build -v make
  - make fclean
  - scan-build -v --status-bugs -analyze-headers make

matrix:
  include:

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
      env:
         - MATRIX_EVAL="CC=gcc-4.9 && CXX=g++-4.9"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
      env:
         - MATRIX_EVAL="CC=gcc-5 && CXX=g++-5"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-6
      env:
        - MATRIX_EVAL="CC=gcc-6 && CXX=g++-6"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-7
      env:
        - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"

    
    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.6
          packages:
            - clang-3.6
      env:
        - MATRIX_EVAL="CC=clang-3.6 && CXX=clang++-3.6"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.7
          packages:
            - clang-3.7
      env:
        - MATRIX_EVAL="CC=clang-3.7 && CXX=clang++-3.7"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.8
          packages:
            - clang-3.8
      env:
        - MATRIX_EVAL="CC=clang-3.8 && CXX=clang++-3.8"

    # works on Trusty
    - os: linux
      addons:
        apt:
          sources:
            - llvm-toolchain-trusty-3.9
          packages:
            - clang-3.9
      env:
        - MATRIX_EVAL="CC=clang-3.9 && CXX=clang++-3.9"

    # works on Trusty
    - os: linux
      addons:
        apt:
          sources:
            - llvm-toolchain-trusty-4.0
          packages:
            - clang-4.0
      env:
        - MATRIX_EVAL="CC=clang-4.0 && CXX=clang++-4.0"

    # works on Trusty
    - os: linux
      addons:
        apt:
          sources:
            - llvm-toolchain-trusty-5.0
          packages:
            - clang-5.0
      env:
        - MATRIX_EVAL="CC=clang-5.0 && CXX=clang++-5.0"

before_install:
    - eval "${MATRIX_EVAL}"


env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "LNPAb4sW6s7Zz5P9jtH43qdiExdYMnGEnMOepiwTdPfIqlWdZgkqdWrSyjf++/+r/aZ9oi6cHZPdOomzNymCZpbxVbrbJGqOl4euDCpgtiYJe3E4SBPHEyLdvmobM+NXytghD4/g9n8f2Pyg8SQVMTWpptzN6gX/fdR/7OvBwurWI6S6HYLx58aR4BXDanqUlXC/1nqMkC/Fug6xq8TG+Jxs1uL+pGUXtzu4okLk9PPwNh7U8aQbI6wjAK3e0naJ/7wxZuVW7IJKsoorBIATAVg/2zJyI4nTAXJnBzeRhWz6coOFuD7KEJnymMwPW9Ej73R8FvMYCKT5DQnPd8KR9XjjWawLbREdML0U+AFvL7kR1m2ohk2oJQ9aZbj8AE7yoH3ggq0W8a/e5EVK73M6Wa8BEjo5NHAQdYq0qfDKwUbq57GKR23Hwi0XMgBRNltfYy7HGcwqLsajX+F6hHnGf1qWuqAXlRmCTGY5ZT6JhzEoEzLm8CSxuLoaRhbIB/qDc88HeYINXE+tdmHWBl9nh6C1KZ4sdYEDxrUW4AEwljaI63eFK0OiprD3doOFpcTlvnD5eb+Dhv4SiQJwnMEciFYkEZTs7BO0A2Gd+X09rocKQEe+sFy8LYSmKXQE5oQlACl+QZa72VMOr/RSRtEgLnZHCR8tw3MH80VoDw8Ufb0="

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "Z1NZ/ping"
      description: "<Your project description here>"
    notification_email: sofiane.rabah@gmail.com
    build_command_prepend: ""
    build_command: "make"
    branch_pattern: coverity_scan